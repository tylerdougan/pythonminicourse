
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>SIMD Optimizations &#8212; NumPy v1.22 Manual</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="NumPy and SWIG" href="../swig.html" />
    <link rel="prev" title="Memory management in NumPy" href="../c-api/data_memory.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<link rel="stylesheet" href="../../_static/numpy.css" type="text/css" />

    <!-- PR #17220: This is added via javascript in versionwarning.js  -->
    <!-- link rel="canonical" href="http://numpy.org/doc/stable/reference/simd/simd-optimizations.html" / -->


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/numpylogo.svg" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../dev/index.html">
  Development
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://numpy.org/numpy-tutorials/">Learn<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/numpy/numpy" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/numpy_team" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../arrays.html">
   Array objects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../constants.html">
   Constants
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ufuncs.html">
   Universal functions (
   <code class="xref py py-class docutils literal notranslate">
    <span class="pre">
     ufunc
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../routines.html">
   Routines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../typing.html">
   Typing (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     numpy.typing
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../global_state.html">
   Global State
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../distutils.html">
   Packaging (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     numpy.distutils
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../distutils_guide.html">
   NumPy Distutils - Users Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../c-api/index.html">
   NumPy C-API
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   SIMD Optimizations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../swig.html">
   NumPy and SWIG
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-options-for-compilation">
   Build options for compilation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#x86-cpu-feature-names">
     x86 - CPU feature names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#x86-group-names">
     x86 - Group names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ibm-power-big-endian-cpu-feature-names">
     IBM/POWER big-endian - CPU feature names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ibm-power-little-endian-cpu-feature-names">
     IBM/POWER little-endian - CPU feature names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#armv7-a32-cpu-feature-names">
     ARMv7/A32 - CPU feature names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#armv8-a64-cpu-feature-names">
     ARMv8/A64 - CPU feature names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#x86-intel-compiler-cpu-feature-names">
     x86::Intel Compiler - CPU feature names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#x86-microsoft-visual-c-c-cpu-feature-names">
     x86::Microsoft Visual C/C++ - CPU feature names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#special-options">
     Special options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes">
     NOTES
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#special-cases">
     Special cases
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#behaviors-and-errors">
     Behaviors and Errors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#usage-and-examples">
     Usage and Examples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#report-and-trace">
     Report and Trace
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#understanding-cpu-dispatching-how-the-numpy-dispatcher-works">
   Understanding CPU Dispatching, How the NumPy dispatcher works?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuration">
     1- Configuration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discovering-the-environment">
     2- Discovering the environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validating-the-requested-optimizations">
     3- Validating the requested optimizations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-the-main-configuration-header">
     4- Generating the main configuration header
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dispatch-able-sources-and-configuration-statements">
     5- Dispatch-able sources and configuration statements
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dive-into-the-cpu-dispatcher">
   Dive into the CPU dispatcher
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-baseline">
     The baseline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dispatcher">
     Dispatcher
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#groups-and-policies">
     Groups and Policies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examples">
     Examples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Report and Trace
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="simd-optimizations">
<h1>SIMD Optimizations<a class="headerlink" href="#simd-optimizations" title="Permalink to this headline">¶</a></h1>
<p>NumPy provides a set of macros that define <a class="reference external" href="https://numpy.org/neps/nep-0038-SIMD-optimizations.html">Universal Intrinsics</a> to
abstract out typical platform-specific intrinsics so SIMD code needs to be
written only once. There are three layers:</p>
<ul class="simple">
<li><p>Code is <em>written</em> using the universal intrinsic macros, with guards that
will enable use of the macros only when the compiler recognizes them.
In NumPy, these are used to construct multiple ufunc loops. Current policy is
to create three loops: One loop is the default and uses no intrinsics. One
uses the minimum intrinsics required on the architecture. And the third is
written using the maximum set of intrinsics possible.</p></li>
<li><p>At <em>compile</em> time, a distutils command is used to define the minimum and
maximum features to support, based on user choice and compiler support. The
appropriate macros are overlaid with the platform / architecture intrinsics,
and the three loops are compiled.</p></li>
<li><p>At <em>runtime import</em>, the CPU is probed for the set of supported intrinsic
features. A mechanism is used to grab the pointer to the most appropriate
function, and this will be the one called for the function.</p></li>
</ul>
<section id="build-options-for-compilation">
<h2>Build options for compilation<a class="headerlink" href="#build-options-for-compilation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code>: minimal set of required optimizations. Default
value is <code class="docutils literal notranslate"><span class="pre">min</span></code> which provides the minimum CPU features that can
safely run on a wide range of platforms within the processor family.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--cpu-dispatch</span></code>: dispatched set of additional optimizations.
The default value is <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">-xop</span> <span class="pre">-fma4</span></code> which enables all CPU
features, except for AMD legacy features(in case of X86).</p></li>
</ul>
<p>The command arguments are available in <code class="docutils literal notranslate"><span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">build_clib</span></code>, and
<code class="docutils literal notranslate"><span class="pre">build_ext</span></code>.
if <code class="docutils literal notranslate"><span class="pre">build_clib</span></code> or <code class="docutils literal notranslate"><span class="pre">build_ext</span></code> are not specified by the user, the arguments of
<code class="docutils literal notranslate"><span class="pre">build</span></code> will be used instead, which also holds the default values.</p>
<p>Optimization names can be CPU features or groups of features that gather
several features or <a class="reference internal" href="#special-options"><span class="std std-ref">special options</span></a> to perform a series of procedures.</p>
<p>The following tables show the current supported optimizations sorted from the lowest to the highest interest.</p>
<section id="x86-cpu-feature-names">
<h3>x86 - CPU feature names<a class="headerlink" href="#x86-cpu-feature-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SSE2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SSE3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SSSE3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SSE41</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POPCNT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SSE42</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">XOP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">FMA4</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">F16C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">FMA3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AVX2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512F</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="x86-group-names">
<h3>x86 - Group names<a class="headerlink" href="#x86-group-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 6%" />
<col style="width: 22%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Gather</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512_KNL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AVX512ER</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512PF</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512_KNM</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AVX5124FMAPS</span></code> <code class="docutils literal notranslate"><span class="pre">AVX5124VNNIW</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512VPOPCNTDQ</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512_KNL</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512_SKX</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AVX512VL</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512BW</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512DQ</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512_CLX</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AVX512VNNI</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512_SKX</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512_CNL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AVX512IFMA</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512VBMI</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512_SKX</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512_ICL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AVX512VBMI2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512BITALG</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512VPOPCNTDQ</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512_SKX</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512_CLX</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512_CNL</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="ibm-power-big-endian-cpu-feature-names">
<h3>IBM/POWER big-endian - CPU feature names<a class="headerlink" href="#ibm-power-big-endian-cpu-feature-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VSX</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">VSX2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VSX</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VSX3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VSX</span></code> <code class="docutils literal notranslate"><span class="pre">VSX2</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="ibm-power-little-endian-cpu-feature-names">
<h3>IBM/POWER little-endian - CPU feature names<a class="headerlink" href="#ibm-power-little-endian-cpu-feature-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VSX</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VSX2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">VSX2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VSX</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VSX3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VSX</span></code> <code class="docutils literal notranslate"><span class="pre">VSX2</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="armv7-a32-cpu-feature-names">
<h3>ARMv7/A32 - CPU feature names<a class="headerlink" href="#armv7-a32-cpu-feature-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMDHP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMDDP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMDFHM</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMDHP</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="armv8-a64-cpu-feature-names">
<h3>ARMv8/A64 - CPU feature names<a class="headerlink" href="#armv8-a64-cpu-feature-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMDHP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMDDP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ASIMDFHM</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMD</span></code> <code class="docutils literal notranslate"><span class="pre">ASIMDHP</span></code></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p id="tables-diff">While the above tables are based on the GCC Compiler, the following tables showing the differences in the
other compilers:</p>
</section>
<section id="x86-intel-compiler-cpu-feature-names">
<h3>x86::Intel Compiler - CPU feature names<a class="headerlink" href="#x86-intel-compiler-cpu-feature-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">FMA3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <strong>AVX2</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <strong>FMA3</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512F</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <strong>AVX512CD</strong></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following features aren’t supported by x86::Intel Compiler:
<strong>XOP FMA4</strong></p>
</div>
</section>
<section id="x86-microsoft-visual-c-c-cpu-feature-names">
<h3>x86::Microsoft Visual C/C++ - CPU feature names<a class="headerlink" href="#x86-microsoft-visual-c-c-cpu-feature-names" title="Permalink to this headline">¶</a></h3>
<table class="table">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Implies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">FMA3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <strong>AVX2</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <strong>FMA3</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512F</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <strong>AVX512CD</strong> <strong>AVX512_SKX</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AVX512CD</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSSE3</span></code> <code class="docutils literal notranslate"><span class="pre">SSE41</span></code> <code class="docutils literal notranslate"><span class="pre">POPCNT</span></code> <code class="docutils literal notranslate"><span class="pre">SSE42</span></code> <code class="docutils literal notranslate"><span class="pre">AVX</span></code> <code class="docutils literal notranslate"><span class="pre">F16C</span></code> <code class="docutils literal notranslate"><span class="pre">FMA3</span></code> <code class="docutils literal notranslate"><span class="pre">AVX2</span></code> <code class="docutils literal notranslate"><span class="pre">AVX512F</span></code> <strong>AVX512_SKX</strong></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following features aren’t supported by x86::Microsoft Visual C/C++:
<strong>AVX512_KNL AVX512_KNM</strong></p>
</div>
</section>
<section id="special-options">
<span id="id1"></span><h3>Special options<a class="headerlink" href="#special-options" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">NONE</span></code>: enable no features</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">NATIVE</span></code>: Enables all CPU features that supported by the current</dt><dd><p>machine, this operation is based on the compiler flags (<code class="docutils literal notranslate"><span class="pre">-march=native,</span> <span class="pre">-xHost,</span> <span class="pre">/QxHost</span></code>)</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MIN</span></code>: Enables the minimum CPU features that can safely run on a wide range of platforms:</p>
<table class="table">
<colgroup>
<col style="width: 49%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>For Arch</p></th>
<th class="head"><p>Returns</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">x86</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">x86</span></code> <code class="docutils literal notranslate"><span class="pre">64-bit</span> <span class="pre">mode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSE</span></code> <code class="docutils literal notranslate"><span class="pre">SSE2</span></code> <code class="docutils literal notranslate"><span class="pre">SSE3</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">IBM/POWER</span></code> <code class="docutils literal notranslate"><span class="pre">big-endian</span> <span class="pre">mode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NONE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">IBM/POWER</span></code> <code class="docutils literal notranslate"><span class="pre">little-endian</span> <span class="pre">mode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VSX</span></code> <code class="docutils literal notranslate"><span class="pre">VSX2</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ARMHF</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NONE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ARM64</span></code> <code class="docutils literal notranslate"><span class="pre">AARCH64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NEON</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_FP16</span></code> <code class="docutils literal notranslate"><span class="pre">NEON_VFPV4</span></code>
<code class="docutils literal notranslate"><span class="pre">ASIMD</span></code></p></td>
</tr>
</tbody>
</table>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAX</span></code>: Enables all supported CPU features by the Compiler and platform.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Operators-/+</span></code>: remove or add features, useful with options <code class="docutils literal notranslate"><span class="pre">MAX</span></code>, <code class="docutils literal notranslate"><span class="pre">MIN</span></code> and <code class="docutils literal notranslate"><span class="pre">NATIVE</span></code>.</p></li>
</ul>
</section>
<section id="notes">
<h3>NOTES<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>CPU features and other options are case-insensitive.</p></li>
<li><p>The order of the requested optimizations doesn’t matter.</p></li>
<li><p>Either commas or spaces can be used as a separator, e.g. <code class="docutils literal notranslate"><span class="pre">--cpu-dispatch</span></code>=
“avx2 avx512f” or <code class="docutils literal notranslate"><span class="pre">--cpu-dispatch</span></code>= “avx2, avx512f” both work, but the
arguments must be enclosed in quotes.</p></li>
<li><p>The operand <code class="docutils literal notranslate"><span class="pre">+</span></code> is only added for nominal reasons, For example:
<code class="docutils literal notranslate"><span class="pre">--cpu-baseline=</span> <span class="pre">&quot;min</span> <span class="pre">avx2&quot;</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">--cpu-baseline=&quot;min</span> <span class="pre">+</span> <span class="pre">avx2&quot;</span></code>.
<code class="docutils literal notranslate"><span class="pre">--cpu-baseline=&quot;min,avx2&quot;</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">--cpu-baseline`=&quot;min,+avx2&quot;</span></code></p></li>
<li><p>If the CPU feature is not supported by the user platform or
compiler, it will be skipped rather than raising a fatal error.</p></li>
<li><p>Any specified CPU feature to <code class="docutils literal notranslate"><span class="pre">--cpu-dispatch</span></code> will be skipped if
it’s part of CPU baseline features</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code> argument force-enables implied features,
e.g. <code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code>=”sse42” is equivalent to
<code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code>=”sse sse2 sse3 ssse3 sse41 popcnt sse42”</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code> will be treated as “native” if
compiler native flag <code class="docutils literal notranslate"><span class="pre">-march=native</span></code> or <code class="docutils literal notranslate"><span class="pre">-xHost</span></code> or <code class="docutils literal notranslate"><span class="pre">QxHost</span></code> is
enabled through environment variable <code class="docutils literal notranslate"><span class="pre">CFLAGS</span></code></p></li>
<li><p>The validation process for the requested optimizations when it comes to
<code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code> isn’t strict. For example, if the user requested
<code class="docutils literal notranslate"><span class="pre">AVX2</span></code> but the compiler doesn’t support it then we just skip it and return
the maximum optimization that the compiler can handle depending on the
implied features of <code class="docutils literal notranslate"><span class="pre">AVX2</span></code>, let us assume <code class="docutils literal notranslate"><span class="pre">AVX</span></code>.</p></li>
<li><p>The user should always check the final report through the build log
to verify the enabled features.</p></li>
</ul>
</section>
<section id="special-cases">
<h3>Special cases<a class="headerlink" href="#special-cases" title="Permalink to this headline">¶</a></h3>
<p><strong>Interrelated CPU features</strong>: Some exceptional conditions force us to link some features together when it come to certain compilers or architectures, resulting in the impossibility of building them separately.
These conditions can be divided into two parts, as follows:</p>
<ul class="simple">
<li><p><strong>Architectural compatibility</strong>: The need to align certain CPU features that are assured
to be supported by successive generations of the same architecture, for example:</p>
<ul>
<li><p>On ppc64le <em class="xref py py-obj">VSX(ISA 2.06)</em> and <em class="xref py py-obj">VSX2(ISA 2.07)</em> both imply one another since the
first generation that supports little-endian mode is Power-8`(ISA 2.07)`</p></li>
<li><p>On AArch64 <em class="xref py py-obj">NEON</em> <em class="xref py py-obj">FP16</em> <em class="xref py py-obj">VFPV4</em> <em class="xref py py-obj">ASIMD</em> implies each other since they are part of the
hardware baseline.</p></li>
</ul>
</li>
<li><p><strong>Compilation compatibility</strong>: Not all <strong>C/C++</strong> compilers provide independent support for all CPU
features. For example, <strong>Intel</strong>’s compiler doesn’t provide separated flags for <em class="xref py py-obj">AVX2</em> and <em class="xref py py-obj">FMA3</em>,
it makes sense since all Intel CPUs that comes with <em class="xref py py-obj">AVX2</em> also support <em class="xref py py-obj">FMA3</em> and vice versa,
but this approach is incompatible with other <strong>x86</strong> CPUs from <strong>AMD</strong> or <strong>VIA</strong>.
Therefore, there are differences in the depiction of CPU features between the C/C++ compilers,
as shown in the <a class="reference internal" href="#tables-diff"><span class="std std-ref">tables above</span></a>.</p></li>
</ul>
</section>
<section id="behaviors-and-errors">
<h3>Behaviors and Errors<a class="headerlink" href="#behaviors-and-errors" title="Permalink to this headline">¶</a></h3>
</section>
<section id="usage-and-examples">
<h3>Usage and Examples<a class="headerlink" href="#usage-and-examples" title="Permalink to this headline">¶</a></h3>
</section>
<section id="report-and-trace">
<h3>Report and Trace<a class="headerlink" href="#report-and-trace" title="Permalink to this headline">¶</a></h3>
</section>
</section>
<section id="understanding-cpu-dispatching-how-the-numpy-dispatcher-works">
<h2>Understanding CPU Dispatching, How the NumPy dispatcher works?<a class="headerlink" href="#understanding-cpu-dispatching-how-the-numpy-dispatcher-works" title="Permalink to this headline">¶</a></h2>
<p>NumPy dispatcher is based on multi-source compiling, which means taking
a certain source and compiling it multiple times with different compiler
flags and also with different <strong>C</strong> definitions that affect the code
paths to enable certain instruction-sets for each compiled object
depending on the required optimizations, then combining the returned
objects together.</p>
<figure class="align-default">
<img alt="../../_images/opt-infra.png" src="../../_images/opt-infra.png" />
</figure>
<p>This mechanism should support all compilers and it doesn’t require any
compiler-specific extension, but at the same time it is adds a few steps to
normal compilation that are explained as follows:</p>
<section id="configuration">
<h3>1- Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Configuring the required optimization by the user before starting to build the
source files via the two command arguments as explained above:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code>: minimal set of required optimizations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--cpu-dispatch</span></code>: dispatched set of additional optimizations.</p></li>
</ul>
</section>
<section id="discovering-the-environment">
<h3>2- Discovering the environment<a class="headerlink" href="#discovering-the-environment" title="Permalink to this headline">¶</a></h3>
<p>In this part, we check the compiler and platform architecture
and cache some of the intermediary results to speed up rebuilding.</p>
</section>
<section id="validating-the-requested-optimizations">
<h3>3- Validating the requested optimizations<a class="headerlink" href="#validating-the-requested-optimizations" title="Permalink to this headline">¶</a></h3>
<p>By testing them against the compiler, and seeing what the compiler can
support according to the requested optimizations.</p>
</section>
<section id="generating-the-main-configuration-header">
<h3>4- Generating the main configuration header<a class="headerlink" href="#generating-the-main-configuration-header" title="Permalink to this headline">¶</a></h3>
<p>The generated header <code class="docutils literal notranslate"><span class="pre">_cpu_dispatch.h</span></code> contains all the definitions and
headers of instruction-sets for the required optimizations that have been
validated during the previous step.</p>
<p>It also contains extra C definitions that are used for defining NumPy’s
Python-level module attributes <code class="docutils literal notranslate"><span class="pre">__cpu_baseline__</span></code> and <code class="docutils literal notranslate"><span class="pre">__cpu_dispaٍtch__</span></code>.</p>
<p><strong>What is in this header?</strong></p>
<p>The example header was dynamically generated by gcc on an X86 machine.
The compiler supports <code class="docutils literal notranslate"><span class="pre">--cpu-baseline=&quot;sse</span> <span class="pre">sse2</span> <span class="pre">sse3&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">--cpu-dispatch=&quot;ssse3</span> <span class="pre">sse41&quot;</span></code>, and the result is below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// The header should be located at numpy/numpy/core/src/common/_cpu_dispatch.h</span>
<span class="cm">/**NOTE</span>
<span class="cm"> ** C definitions prefixed with &quot;NPY_HAVE_&quot; represent</span>
<span class="cm"> ** the required optimzations.</span>
<span class="cm"> **</span>
<span class="cm"> ** C definitions prefixed with &#39;NPY__CPU_TARGET_&#39; are protected and</span>
<span class="cm"> ** shouldn&#39;t be used by any NumPy C sources.</span>
<span class="cm"> */</span><span class="w"></span>
<span class="cm">/******* baseline features *******/</span><span class="w"></span>
<span class="cm">/** SSE **/</span><span class="w"></span>
<span class="cp">#define NPY_HAVE_SSE 1</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;xmmintrin.h&gt;</span><span class="cp"></span>
<span class="cm">/** SSE2 **/</span><span class="w"></span>
<span class="cp">#define NPY_HAVE_SSE2 1</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;emmintrin.h&gt;</span><span class="cp"></span>
<span class="cm">/** SSE3 **/</span><span class="w"></span>
<span class="cp">#define NPY_HAVE_SSE3 1</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pmmintrin.h&gt;</span><span class="cp"></span>

<span class="cm">/******* dispatch-able features *******/</span><span class="w"></span>
<span class="cp">#ifdef NPY__CPU_TARGET_SSSE3</span>
<span class="w">  </span><span class="cm">/** SSSE3 **/</span><span class="w"></span>
<span class="w">  </span><span class="cp">#define NPY_HAVE_SSSE3 1</span>
<span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;tmmintrin.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef NPY__CPU_TARGET_SSE41</span>
<span class="w">  </span><span class="cm">/** SSE41 **/</span><span class="w"></span>
<span class="w">  </span><span class="cp">#define NPY_HAVE_SSE41 1</span>
<span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;smmintrin.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p><strong>Baseline features</strong> are the minimal set of required optimizations configured
via <code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code>. They have no preprocessor guards and they’re
always on, which means they can be used in any source.</p>
<p>Does this mean NumPy’s infrastructure passes the compiler’s flags of
baseline features to all sources?</p>
<p>Definitely, yes. But the <a class="reference internal" href="#dispatchable-sources"><span class="std std-ref">dispatch-able sources</span></a> are
treated differently.</p>
<p>What if the user specifies certain <strong>baseline features</strong> during the
build but at runtime the machine doesn’t support even these
features? Will the compiled code be called via one of these definitions, or
maybe the compiler itself auto-generated/vectorized certain piece of code
based on the provided command line compiler flags?</p>
<p>During the loading of the NumPy module, there’s a validation step
which detects this behavior. It will raise a Python runtime error to inform the
user. This is to prevent the CPU reaching an illegal instruction error causing
a segfault.</p>
<p><strong>Dispatch-able features</strong> are our dispatched set of additional optimizations
that were configured via <code class="docutils literal notranslate"><span class="pre">--cpu-dispatch</span></code>. They are not activated by
default and are always guarded by other C definitions prefixed with
<code class="docutils literal notranslate"><span class="pre">NPY__CPU_TARGET_</span></code>. C definitions <code class="docutils literal notranslate"><span class="pre">NPY__CPU_TARGET_</span></code> are only
enabled within <strong>dispatch-able sources</strong>.</p>
</section>
<section id="dispatch-able-sources-and-configuration-statements">
<span id="dispatchable-sources"></span><h3>5- Dispatch-able sources and configuration statements<a class="headerlink" href="#dispatch-able-sources-and-configuration-statements" title="Permalink to this headline">¶</a></h3>
<p>Dispatch-able sources are special <strong>C</strong> files that can be compiled multiple
times with different compiler flags and also with different <strong>C</strong>
definitions. These affect code paths to enable certain
instruction-sets for each compiled object according to “<strong>the
configuration statements</strong>” that must be declared between a <strong>C</strong>
comment<code class="docutils literal notranslate"><span class="pre">(/**/)</span></code> and start with a special mark <strong>&#64;targets</strong> at the
top of each dispatch-able source. At the same time, dispatch-able
sources will be treated as normal <strong>C</strong> sources if the optimization was
disabled by the command argument <code class="docutils literal notranslate"><span class="pre">--disable-optimization</span></code> .</p>
<p><strong>What are configuration statements?</strong></p>
<p>Configuration statements are sort of keywords combined together to
determine the required optimization for the dispatch-able source.</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*@targets avx2 avx512f vsx2 vsx3 asimd asimdhp */</span><span class="w"></span>
<span class="c1">// C code</span>
</pre></div>
</div>
<p>The keywords mainly represent the additional optimizations configured
through <code class="docutils literal notranslate"><span class="pre">--cpu-dispatch</span></code>, but it can also represent other options such as:</p>
<ul class="simple">
<li><p>Target groups: pre-configured configuration statements used for
managing the required optimizations from outside the dispatch-able source.</p></li>
<li><p>Policies: collections of options used for changing the default
behaviors or forcing the compilers to perform certain things.</p></li>
<li><p>“baseline”: a unique keyword represents the minimal optimizations
that configured through <code class="docutils literal notranslate"><span class="pre">--cpu-baseline</span></code></p></li>
</ul>
<p><strong>Numpy’s infrastructure handles dispatch-able sources in four steps</strong>:</p>
<ul>
<li><p><strong>(A) Recognition</strong>: Just like source templates and F2PY, the
dispatch-able sources requires a special extension <code class="docutils literal notranslate"><span class="pre">*.dispatch.c</span></code>
to mark C dispatch-able source files, and for C++
<code class="docutils literal notranslate"><span class="pre">*.dispatch.cpp</span></code> or <code class="docutils literal notranslate"><span class="pre">*.dispatch.cxx</span></code>
<strong>NOTE</strong>: C++ not supported yet.</p></li>
<li><p><strong>(B) Parsing and validating</strong>: In this step, the
dispatch-able sources that had been filtered by the previous step
are parsed and validated by the configuration statements for each one
of them one by one in order to determine the required optimizations.</p></li>
<li><p><strong>(C) Wrapping</strong>: This is the approach taken by NumPy’s
infrastructure, which has proved to be sufficiently flexible in order
to compile a single source multiple times with different <strong>C</strong>
definitions and flags that affect the code paths. The process is
achieved by creating a temporary <strong>C</strong> source for each required
optimization that related to the additional optimization, which
contains the declarations of the <strong>C</strong> definitions and includes the
involved source via the <strong>C</strong> directive <strong>#include</strong>. For more
clarification take a look at the following code for AVX512F :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * this definition is used by NumPy utilities as suffixes for the</span>
<span class="cm"> * exported symbols</span>
<span class="cm"> */</span><span class="w"></span>
<span class="cp">#define NPY__CPU_TARGET_CURRENT AVX512F</span>
<span class="cm">/*</span>
<span class="cm"> * The following definitions enable</span>
<span class="cm"> * definitions of the dispatch-able features that are defined within the main</span>
<span class="cm"> * configuration header. These are definitions for the implied features.</span>
<span class="cm"> */</span><span class="w"></span>
<span class="cp">#define NPY__CPU_TARGET_SSE</span>
<span class="cp">#define NPY__CPU_TARGET_SSE2</span>
<span class="cp">#define NPY__CPU_TARGET_SSE3</span>
<span class="cp">#define NPY__CPU_TARGET_SSSE3</span>
<span class="cp">#define NPY__CPU_TARGET_SSE41</span>
<span class="cp">#define NPY__CPU_TARGET_POPCNT</span>
<span class="cp">#define NPY__CPU_TARGET_SSE42</span>
<span class="cp">#define NPY__CPU_TARGET_AVX</span>
<span class="cp">#define NPY__CPU_TARGET_F16C</span>
<span class="cp">#define NPY__CPU_TARGET_FMA3</span>
<span class="cp">#define NPY__CPU_TARGET_AVX2</span>
<span class="cp">#define NPY__CPU_TARGET_AVX512F</span>
<span class="c1">// our dispatch-able source</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;/the/absuolate/path/of/hello.dispatch.c&quot;</span><span class="cp"></span>
</pre></div>
</div>
</li>
<li><p><strong>(D) Dispatch-able configuration header</strong>: The infrastructure
generates a config header for each dispatch-able source, this header
mainly contains two abstract <strong>C</strong> macros used for identifying the
generated objects, so they can be used for runtime dispatching
certain symbols from the generated objects by any <strong>C</strong> source. It is
also used for forward declarations.</p>
<p>The generated header takes the name of the dispatch-able source after
excluding the extension and replace it with ‘<strong>.h</strong>’, for example
assume we have a dispatch-able source called <strong>hello.dispatch.c</strong> and
contains the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// hello.dispatch.c</span>
<span class="cm">/*@targets baseline sse42 avx512f */</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;numpy/utils.h&quot;</span><span class="c1"> // NPY_CAT, NPY_TOSTR</span><span class="cp"></span>

<span class="cp">#ifndef NPY__CPU_TARGET_CURRENT</span>
<span class="w">  </span><span class="c1">// wrapping the dispatch-able source only happens to the additional optimizations</span>
<span class="w">  </span><span class="c1">// but if the keyword &#39;baseline&#39; provided within the configuration statements,</span>
<span class="w">  </span><span class="c1">// the infrastructure will add extra compiling for the dispatch-able source by</span>
<span class="w">  </span><span class="c1">// passing it as-is to the compiler without any changes.</span>
<span class="w">  </span><span class="cp">#define CURRENT_TARGET(X) X</span>
<span class="w">  </span><span class="cp">#define NPY__CPU_TARGET_CURRENT baseline </span><span class="c1">// for printing only</span>
<span class="cp">#else</span>
<span class="w">  </span><span class="c1">// since we reach to this point, that&#39;s mean we&#39;re dealing with</span>
<span class="w">    </span><span class="c1">// the additional optimizations, so it could be SSE42 or AVX512F</span>
<span class="w">  </span><span class="cp">#define CURRENT_TARGET(X) NPY_CAT(NPY_CAT(X, _), NPY__CPU_TARGET_CURRENT)</span>
<span class="cp">#endif</span>
<span class="c1">// Macro &#39;CURRENT_TARGET&#39; adding the current target as suffux to the exported symbols,</span>
<span class="c1">// to avoid linking duplications, NumPy already has a macro called</span>
<span class="c1">// &#39;NPY_CPU_DISPATCH_CURFX&#39; similar to it, located at</span>
<span class="c1">// numpy/numpy/core/src/common/npy_cpu_dispatch.h</span>
<span class="c1">// NOTE: we tend to not adding suffixes to the baseline exported symbols</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">CURRENT_TARGET</span><span class="p">(</span><span class="n">simd_whoami</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">extra_info</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;I&#39;m &quot;</span><span class="w"> </span><span class="n">NPY_TOSTR</span><span class="p">(</span><span class="n">NPY__CPU_TARGET_CURRENT</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;, %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">extra_info</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Now assume you attached <strong>hello.dispatch.c</strong> to the source tree, then
the infrastructure should generate a temporary config header called
<strong>hello.dispatch.h</strong> that can be reached by any source in the source
tree, and it should contain the following code :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef NPY__CPU_DISPATCH_EXPAND_</span>
<span class="w">  </span><span class="c1">// To expand the macro calls in this header</span>
<span class="w">    </span><span class="cp">#define NPY__CPU_DISPATCH_EXPAND_(X) X</span>
<span class="cp">#endif</span>
<span class="c1">// Undefining the following macros, due to the possibility of including config headers</span>
<span class="c1">// multiple times within the same source and since each config header represents</span>
<span class="c1">// different required optimizations according to the specified configuration</span>
<span class="c1">// statements in the dispatch-able source that derived from it.</span>
<span class="cp">#undef NPY__CPU_DISPATCH_BASELINE_CALL</span>
<span class="cp">#undef NPY__CPU_DISPATCH_CALL</span>
<span class="c1">// nothing strange here, just a normal preprocessor callback</span>
<span class="c1">// enabled only if &#39;baseline&#39; specified within the configuration statements</span>
<span class="cp">#define NPY__CPU_DISPATCH_BASELINE_CALL(CB, ...) \</span>
<span class="cp">  NPY__CPU_DISPATCH_EXPAND_(CB(__VA_ARGS__))</span>
<span class="c1">// &#39;NPY__CPU_DISPATCH_CALL&#39; is an abstract macro is used for dispatching</span>
<span class="c1">// the required optimizations that specified within the configuration statements.</span>
<span class="c1">//</span>
<span class="c1">// @param CHK, Expected a macro that can be used to detect CPU features</span>
<span class="c1">// in runtime, which takes a CPU feature name without string quotes and</span>
<span class="c1">// returns the testing result in a shape of boolean value.</span>
<span class="c1">// NumPy already has macro called &quot;NPY_CPU_HAVE&quot;, which fits this requirement.</span>
<span class="c1">//</span>
<span class="c1">// @param CB, a callback macro that expected to be called multiple times depending</span>
<span class="c1">// on the required optimizations, the callback should receive the following arguments:</span>
<span class="c1">//  1- The pending calls of @param CHK filled up with the required CPU features,</span>
<span class="c1">//     that need to be tested first in runtime before executing call belong to</span>
<span class="c1">//     the compiled object.</span>
<span class="c1">//  2- The required optimization name, same as in &#39;NPY__CPU_TARGET_CURRENT&#39;</span>
<span class="c1">//  3- Extra arguments in the macro itself</span>
<span class="c1">//</span>
<span class="c1">// By default the callback calls are sorted depending on the highest interest</span>
<span class="c1">// unless the policy &quot;$keep_sort&quot; was in place within the configuration statements</span>
<span class="c1">// see &quot;Dive into the CPU dispatcher&quot; for more clarification.</span>
<span class="cp">#define NPY__CPU_DISPATCH_CALL(CHK, CB, ...) \</span>
<span class="cp">  NPY__CPU_DISPATCH_EXPAND_(CB((CHK(AVX512F)), AVX512F, __VA_ARGS__)) \</span>
<span class="cp">  NPY__CPU_DISPATCH_EXPAND_(CB((CHK(SSE)&amp;&amp;CHK(SSE2)&amp;&amp;CHK(SSE3)&amp;&amp;CHK(SSSE3)&amp;&amp;CHK(SSE41)), SSE41, __VA_ARGS__))</span>
</pre></div>
</div>
<p>An example of using the config header in light of the above:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// NOTE: The following macros are only defined for demonstration purposes only.</span>
<span class="c1">// NumPy already has a collections of macros located at</span>
<span class="c1">// numpy/numpy/core/src/common/npy_cpu_dispatch.h, that covers all dispatching</span>
<span class="c1">// and declarations scenarios.</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;numpy/npy_cpu_features.h&quot;</span><span class="c1"> // NPY_CPU_HAVE</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;numpy/utils.h&quot;</span><span class="c1"> // NPY_CAT, NPY_EXPAND</span><span class="cp"></span>

<span class="c1">// An example for setting a macro that calls all the exported symbols at once</span>
<span class="c1">// after checking if they&#39;re supported by the running machine.</span>
<span class="cp">#define DISPATCH_CALL_ALL(FN, ARGS) \</span>
<span class="cp">    NPY__CPU_DISPATCH_CALL(NPY_CPU_HAVE, DISPATCH_CALL_ALL_CB, FN, ARGS) \</span>
<span class="cp">    NPY__CPU_DISPATCH_BASELINE_CALL(DISPATCH_CALL_BASELINE_ALL_CB, FN, ARGS)</span>
<span class="c1">// The preprocessor callbacks.</span>
<span class="c1">// The same suffixes as we define it in the dispatch-able source.</span>
<span class="cp">#define DISPATCH_CALL_ALL_CB(CHECK, TARGET_NAME, FN, ARGS) \</span>
<span class="cp">  if (CHECK) { NPY_CAT(NPY_CAT(FN, _), TARGET_NAME) ARGS; }</span>
<span class="cp">#define DISPATCH_CALL_BASELINE_ALL_CB(FN, ARGS) \</span>
<span class="cp">  FN NPY_EXPAND(ARGS);</span>

<span class="c1">// An example for setting a macro that calls the exported symbols of highest</span>
<span class="c1">// interest optimization, after checking if they&#39;re supported by the running machine.</span>
<span class="cp">#define DISPATCH_CALL_HIGH(FN, ARGS) \</span>
<span class="cp">  if (0) {} \</span>
<span class="cp">    NPY__CPU_DISPATCH_CALL(NPY_CPU_HAVE, DISPATCH_CALL_HIGH_CB, FN, ARGS) \</span>
<span class="cp">    NPY__CPU_DISPATCH_BASELINE_CALL(DISPATCH_CALL_BASELINE_HIGH_CB, FN, ARGS)</span>
<span class="c1">// The preprocessor callbacks</span>
<span class="c1">// The same suffixes as we define it in the dispatch-able source.</span>
<span class="cp">#define DISPATCH_CALL_HIGH_CB(CHECK, TARGET_NAME, FN, ARGS) \</span>
<span class="cp">  else if (CHECK) { NPY_CAT(NPY_CAT(FN, _), TARGET_NAME) ARGS; }</span>
<span class="cp">#define DISPATCH_CALL_BASELINE_HIGH_CB(FN, ARGS) \</span>
<span class="cp">  else { FN NPY_EXPAND(ARGS); }</span>

<span class="c1">// NumPy has a macro called &#39;NPY_CPU_DISPATCH_DECLARE&#39; can be used</span>
<span class="c1">// for forward declrations any kind of prototypes based on</span>
<span class="c1">// &#39;NPY__CPU_DISPATCH_CALL&#39; and &#39;NPY__CPU_DISPATCH_BASELINE_CALL&#39;.</span>
<span class="c1">// However in this example, we just handle it manually.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">simd_whoami</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">extra_info</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">simd_whoami_AVX512F</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">extra_info</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">simd_whoami_SSE41</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">extra_info</span><span class="p">);</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">trigger_me</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// bring the auto-gernreated config header</span>
<span class="w">    </span><span class="c1">// which contains config macros &#39;NPY__CPU_DISPATCH_CALL&#39; and</span>
<span class="w">    </span><span class="c1">// &#39;NPY__CPU_DISPATCH_BASELINE_CALL&#39;.</span>
<span class="w">    </span><span class="c1">// it highely recomaned to include the config header before exectuing</span>
<span class="w">  </span><span class="c1">// the dispatching macros in case if there&#39;s another header in the scope.</span>
<span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;hello.dispatch.h&quot;</span><span class="cp"></span>
<span class="w">    </span><span class="n">DISPATCH_CALL_ALL</span><span class="p">(</span><span class="n">simd_whoami</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="n">DISPATCH_CALL_HIGH</span><span class="p">(</span><span class="n">simd_whoami</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;the highest interest&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="c1">// An example of including multiple config headers in the same source</span>
<span class="w">    </span><span class="c1">// #include &quot;hello2.dispatch.h&quot;</span>
<span class="w">    </span><span class="c1">// DISPATCH_CALL_HIGH(another_function, (&quot;the highest interest&quot;))</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="dive-into-the-cpu-dispatcher">
<h2>Dive into the CPU dispatcher<a class="headerlink" href="#dive-into-the-cpu-dispatcher" title="Permalink to this headline">¶</a></h2>
<section id="the-baseline">
<h3>The baseline<a class="headerlink" href="#the-baseline" title="Permalink to this headline">¶</a></h3>
</section>
<section id="dispatcher">
<h3>Dispatcher<a class="headerlink" href="#dispatcher" title="Permalink to this headline">¶</a></h3>
</section>
<section id="groups-and-policies">
<h3>Groups and Policies<a class="headerlink" href="#groups-and-policies" title="Permalink to this headline">¶</a></h3>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
</section>
<section id="id2">
<h3>Report and Trace<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
</section>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../c-api/data_memory.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Memory management in NumPy</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../swig.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">NumPy and SWIG</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2008-2022, NumPy Developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>